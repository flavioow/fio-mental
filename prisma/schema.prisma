generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url      = "file:./dev.db"
}

model User {
    id       Int     @id @default(autoincrement())
    name     String
    email    String  @unique
    password String
    img      String?
    telefone String?
    role     Role

    // RelaÃ§Ãµes
    employee     Employee?
    company      Company?
    psychologist Psychologist?

    accounts Account[]
    sessions Session[]
}

model Employee {
    id     Int    @id @default(autoincrement())
    cpf    String @unique
    userId Int    @unique
    user   User   @relation(fields: [userId], references: [id])

    questionario Questionario?
}

model Company {
    id       Int     @id @default(autoincrement())
    nome     String
    cnpj     String  @unique
    endereco String?
    setor    String?

    userId Int  @unique
    user   User @relation(fields: [userId], references: [id])
}

model Psychologist {
    id           Int     @id @default(autoincrement())
    cpf          String  @unique
    crp          String  @unique
    tempoAtuacao Int?
    descricao    String?

    userId Int  @unique
    user   User @relation(fields: [userId], references: [id])
}

model Questionario {
    id               Int     @id @default(autoincrement())
    escalaEstresse   Int
    motivoEstresse   String?
    equilibrio       String?
    reacaoProblema   String?
    espacoBemEstar   String?
    motivacao        String?
    desmotivacao     String?
    melhorHorario    String?
    focoColaborativo String?
    satisfacao       String?
    pedirAjuda       String?
    conflitos        String?
    senteOuvido      String?
    ouvido           Int?
    tipoColega       String?
    ambienteCalmo    String?
    habilidades      String?
    oportunidades    String?
    confianca        String?
    palavra          String?
    mudanca          String?

    // NOVO CAMPO ðŸ‘‡
    perfilPsicologico String? // Resultado da IA em JSON ou texto

    employeeId Int      @unique
    employee   Employee @relation(fields: [employeeId], references: [id])
}

//
// NextAuth Adapter Models
//
model Account {
    id                String  @id @default(cuid())
    userId            Int
    type              String
    provider          String
    providerAccountId String
    refresh_token     String?
    access_token      String?
    expires_at        Int?
    token_type        String?
    scope             String?
    id_token          String?
    session_state     String?

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerAccountId])
}

model Session {
    id           String   @id @default(cuid())
    sessionToken String   @unique
    userId       Int
    expires      DateTime

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

enum Role {
    EMPLOYEE
    COMPANY
    PSYCHOLOGIST
}
